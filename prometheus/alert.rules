groups:
- name: alert_instance
  rules:

  # Alert for any instance that is unreachable for >2 minutes.
  - alert: service_down
    expr: up == 0
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} down"
      description: "{{ $labels.instance }} of {{ $labels.application }} has been down for more than 2 minutes."

  - alert: circuit_break
    expr: resilience4j_circuitbreaker_state{state="open"} > 0
    for: 10s
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} circuit break"
      description: "{{ $labels.instance }} of {{ $labels.application }} has circuit break."

  - alert: cpu_usage
    expr: process_cpu_usage > 0.5
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} high cpu usage"
      description: "{{ $labels.instance }} of {{ $labels.application }} high cpu usage detect."

  - alert: request_failure
    expr: resilience4j_circuitbreaker_failure_rate > 0.5
    for: 10s
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} high request failure rate"
      description: "{{ $labels.instance }} of {{ $labels.application }} high request failure rate detect."
